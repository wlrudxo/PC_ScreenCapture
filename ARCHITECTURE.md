# í™œë™ ì¶”ì  ì‹œìŠ¤í…œ V2 - ì•„í‚¤í…ì²˜ ì„¤ê³„

## ğŸ“‹ ëª©í‘œ
ì—°êµ¬ì‹¤ì—ì„œ ì—…ë¬´ vs ë”´ì§“ ë¹„ìœ¨ì„ ì¶”ì í•˜ëŠ” ê°œì¸ìš© ë°ìŠ¤í¬í†± ì• í”Œë¦¬ì¼€ì´ì…˜

---

## ğŸ—ï¸ ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PyQt6 Frontend                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Dashboard â”‚Timeline  â”‚Settings  â”‚  Tray    â”‚ â”‚
â”‚  â”‚   Tab    â”‚   Tab    â”‚   Tab    â”‚  Icon    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend Core                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MonitorEngine (Thread)                    â”‚ â”‚
â”‚  â”‚  - WindowTracker                           â”‚ â”‚
â”‚  â”‚  - ScreenLockDetector                      â”‚ â”‚
â”‚  â”‚  - ChromeURLReceiver (WebSocket)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  RuleEngine                                â”‚ â”‚
â”‚  â”‚  - í”„ë¡œê·¸ë¨/URL â†’ íƒœê·¸ ë§¤ì¹­                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  DatabaseManager                           â”‚ â”‚
â”‚  â”‚  - SQLite ì €ì¥/ì¡°íšŒ                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SQLite Database                     â”‚
â”‚  - tags                                          â”‚
â”‚  - activities                                    â”‚
â”‚  - rules                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Chrome Extension                        â”‚
â”‚  - í™œì„± íƒ­ URL ì „ì†¡ (WebSocket)                  â”‚
â”‚  - í”„ë¡œí•„ëª… í¬í•¨                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 1. `tags` - íƒœê·¸ ì •ì˜ í…Œì´ë¸”
```sql
CREATE TABLE tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL UNIQUE,        -- íƒœê·¸ ì´ë¦„ (ì˜ˆ: "ì—…ë¬´", "ë”´ì§“", "ìë¦¬ë¹„ì›€")
    color TEXT NOT NULL,               -- UI í‘œì‹œ ìƒ‰ìƒ (ì˜ˆ: "#4CAF50")
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ê¸°ë³¸ íƒœê·¸
INSERT INTO tags (name, color) VALUES
    ('ì—…ë¬´', '#4CAF50'),
    ('ë”´ì§“', '#FF5722'),
    ('ìë¦¬ë¹„ì›€', '#9E9E9E'),
    ('ë¯¸ë¶„ë¥˜', '#607D8B');
```

**íŠ¹ì§•:**
- ID ê¸°ë°˜ ì°¸ì¡° â†’ íƒœê·¸ ì´ë¦„ ë³€ê²½ ì‹œ activities í…Œì´ë¸”ì€ ì˜í–¥ ì—†ìŒ
- ì‚¬ìš©ìê°€ ììœ ë¡­ê²Œ íƒœê·¸ ì¶”ê°€/ì‚­ì œ/ì´ë¦„ë³€ê²½ ê°€ëŠ¥

---

### 2. `activities` - í™œë™ ê¸°ë¡ í…Œì´ë¸”
```sql
CREATE TABLE activities (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP,                -- NULLì´ë©´ í˜„ì¬ ì§„í–‰ ì¤‘

    -- í™œë™ ì •ë³´
    process_name TEXT,                 -- ì˜ˆ: "chrome.exe", "__LOCKED__", "__IDLE__"
    window_title TEXT,                 -- ì˜ˆ: "YouTube - Chrome"
    chrome_profile TEXT,               -- ì˜ˆ: "ì—…ë¬´ìš©", "ë”´ì§“ìš©"
    chrome_url TEXT,                   -- ì˜ˆ: "https://youtube.com/watch?v=..."

    -- ë¶„ë¥˜
    tag_id INTEGER,                    -- tags í…Œì´ë¸” ì™¸ë˜í‚¤
    rule_id INTEGER,                   -- ì–´ë–¤ ë£°ì— ì˜í•´ ë¶„ë¥˜ëëŠ”ì§€

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE SET NULL,
    FOREIGN KEY (rule_id) REFERENCES rules(id) ON DELETE SET NULL
);

-- ì¸ë±ìŠ¤ (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX idx_activities_time ON activities(start_time, end_time);
CREATE INDEX idx_activities_tag ON activities(tag_id);
CREATE INDEX idx_activities_process ON activities(process_name);
```

**íŠ¹ì§•:**
- `start_time` ~ `end_time` êµ¬ê°„ìœ¼ë¡œ í™œë™ ì‹œê°„ ê³„ì‚°
- Chrome URLê³¼ í”„ë¡œí•„ ì •ë³´ ì €ì¥
- í™”ë©´ ì ê¸ˆ/idleì€ `process_name`ì„ `__LOCKED__` / `__IDLE__`ë¡œ ì €ì¥í•˜ì—¬ ë£° ì—”ì§„ì—ì„œ í†µì¼ëœ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬
- tag_idë¡œ íƒœê·¸ ì°¸ì¡° (íƒœê·¸ ì´ë¦„ ë³€ê²½í•´ë„ ê¸°ë¡ ìœ ì§€)

---

### 3. `rules` - ìë™ ë¶„ë¥˜ ë£° í…Œì´ë¸”
```sql
CREATE TABLE rules (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,                -- ë£° ì´ë¦„ (ì˜ˆ: "YouTubeëŠ” ë”´ì§“")
    priority INTEGER DEFAULT 0,        -- ìš°ì„ ìˆœìœ„ (ë†’ì„ìˆ˜ë¡ ë¨¼ì € ì ìš©)
    enabled BOOLEAN DEFAULT 1,         -- í™œì„±í™” ì—¬ë¶€

    -- ë§¤ì¹­ ì¡°ê±´ (OR ê´€ê³„)
    process_pattern TEXT,              -- í”„ë¡œì„¸ìŠ¤ ë§¤ì¹­ (ì˜ˆ: "chrome.exe")
    url_pattern TEXT,                  -- URL ë§¤ì¹­ (ì˜ˆ: "*youtube.com*")
    window_title_pattern TEXT,         -- ì°½ ì œëª© ë§¤ì¹­ (ì˜ˆ: "*YouTube*")
    chrome_profile TEXT,               -- Chrome í”„ë¡œí•„ (ì˜ˆ: "ë”´ì§“ìš©")

    -- ë¶„ë¥˜ ê²°ê³¼
    tag_id INTEGER NOT NULL,           -- ì ìš©í•  íƒœê·¸

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE
);

-- ê¸°ë³¸ ë£° ì˜ˆì‹œ
INSERT INTO rules (name, priority, process_pattern, tag_id) VALUES
    ('í™”ë©´ ì ê¸ˆ', 100, '__LOCKED__', (SELECT id FROM tags WHERE name='ìë¦¬ë¹„ì›€')),
    ('Idle ìƒíƒœ', 90, '__IDLE__', (SELECT id FROM tags WHERE name='ìë¦¬ë¹„ì›€'));

INSERT INTO rules (name, priority, url_pattern, tag_id) VALUES
    ('YouTubeëŠ” ë”´ì§“', 50, '*youtube.com*', (SELECT id FROM tags WHERE name='ë”´ì§“')),
    ('GitHubëŠ” ì—…ë¬´', 50, '*github.com*', (SELECT id FROM tags WHERE name='ì—…ë¬´'));

INSERT INTO rules (name, priority, chrome_profile, tag_id) VALUES
    ('ì—…ë¬´ìš© Chrome', 30, 'ì—…ë¬´ìš©', (SELECT id FROM tags WHERE name='ì—…ë¬´')),
    ('ë”´ì§“ìš© Chrome', 30, 'ë”´ì§“ìš©', (SELECT id FROM tags WHERE name='ë”´ì§“'));
```

**íŠ¹ì§•:**
- ìš°ì„ ìˆœìœ„(priority) ê¸°ë°˜ ì ìš© (ë†’ì€ ê²ƒ ë¨¼ì €)
- ì—¬ëŸ¬ ì¡°ê±´ ì¤‘ í•˜ë‚˜ë¼ë„ ë§¤ì¹˜ë˜ë©´ ì ìš©
- ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´ ì§€ì› (`*youtube.com*`)
- ì‚¬ìš©ìê°€ UIì—ì„œ ììœ ë¡­ê²Œ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ

---

## ğŸ”§ ë°±ì—”ë“œ ëª¨ë“ˆ êµ¬ì¡°

### ğŸ“ íŒŒì¼ êµ¬ì¡°
```
PC_ScreenCapture_V2/
â”œâ”€â”€ main.py                      # ë©”ì¸ ì§„ì…ì 
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py                # ì„¤ì • ë° ê²½ë¡œ ê´€ë¦¬ â­
â”‚   â”œâ”€â”€ monitor_engine.py        # ëª¨ë‹ˆí„°ë§ ì—”ì§„ (ìŠ¤ë ˆë“œ)
â”‚   â”œâ”€â”€ window_tracker.py        # í™œì„± ì°½ ê°ì§€
â”‚   â”œâ”€â”€ screen_detector.py       # í™”ë©´ ì ê¸ˆ/idle ê°ì§€
â”‚   â”œâ”€â”€ chrome_receiver.py       # Chrome WebSocket ì„œë²„
â”‚   â”œâ”€â”€ rule_engine.py           # ë£° ë§¤ì¹­ ì—”ì§„
â”‚   â””â”€â”€ database.py              # DB ë§¤ë‹ˆì €
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main_window.py           # ë©”ì¸ ìœˆë„ìš°
â”‚   â”œâ”€â”€ dashboard_tab.py         # ëŒ€ì‹œë³´ë“œ íƒ­
â”‚   â”œâ”€â”€ timeline_tab.py          # íƒ€ì„ë¼ì¸ íƒ­
â”‚   â”œâ”€â”€ settings_tab.py          # ì„¤ì • íƒ­
â”‚   â”œâ”€â”€ tray_icon.py             # ì‹œìŠ¤í…œ íŠ¸ë ˆì´
â”‚   â””â”€â”€ styles.py                # QSS ìŠ¤íƒ€ì¼
â”œâ”€â”€ chrome_extension/            # Chrome í™•ì¥
â”‚   â”œâ”€â”€ manifest.json
â”‚   â”œâ”€â”€ background.js
â”‚   â”œâ”€â”€ popup.html
â”‚   â””â”€â”€ popup.js
â””â”€â”€ activity_tracker.db          # SQLite DB
```

---

### 0ï¸âƒ£ `backend/config.py` - ì„¤ì • ë° ê²½ë¡œ ê´€ë¦¬
```python
import os
import sys
from pathlib import Path

class AppConfig:
    """
    ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ë° ê²½ë¡œ ê´€ë¦¬

    ê°œë°œ ëª¨ë“œ vs ë¹Œë“œ ëª¨ë“œ ìë™ êµ¬ë¶„:
    - ê°œë°œ ì¤‘: í”„ë¡œì íŠ¸ í´ë”ì— DB/ì„¤ì • ì €ì¥ (ë””ë²„ê¹… í¸í•¨)
    - ë¹Œë“œ í›„: AppDataì— ì €ì¥ (Windows í‘œì¤€)
    """

    @staticmethod
    def is_dev_mode():
        """
        ê°œë°œ ëª¨ë“œ ì²´í¬
        PyInstallerë¡œ ë¹Œë“œë˜ë©´ sys.frozen = True
        """
        return not getattr(sys, 'frozen', False)

    @staticmethod
    def get_app_dir():
        """
        ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„° ë””ë ‰í† ë¦¬

        ê°œë°œ ëª¨ë“œ:
            H:\GitProject\PC_ScreenCapture_V2\

        ë¹Œë“œ ëª¨ë“œ:
            C:\Users\User\AppData\Roaming\ActivityTracker\
        """
        if AppConfig.is_dev_mode():
            # ê°œë°œ ì¤‘: í”„ë¡œì íŠ¸ í´ë”
            return Path(__file__).parent.parent
        else:
            # ë¹Œë“œ í›„: AppData
            if os.name == 'nt':  # Windows
                app_dir = Path(os.getenv('APPDATA')) / "ActivityTracker"
            else:  # macOS, Linux
                app_dir = Path.home() / ".activitytracker"

            app_dir.mkdir(parents=True, exist_ok=True)
            return app_dir

    @staticmethod
    def get_db_path():
        """SQLite DB íŒŒì¼ ê²½ë¡œ"""
        return AppConfig.get_app_dir() / "activity_tracker.db"

    @staticmethod
    def get_config_path():
        """ì„¤ì • íŒŒì¼ ê²½ë¡œ (JSON)"""
        return AppConfig.get_app_dir() / "config.json"

    @staticmethod
    def get_log_dir():
        """ë¡œê·¸ ë””ë ‰í† ë¦¬"""
        log_dir = AppConfig.get_app_dir() / "logs"
        log_dir.mkdir(exist_ok=True)
        return log_dir

    @staticmethod
    def get_log_path():
        """ë¡œê·¸ íŒŒì¼ ê²½ë¡œ"""
        return AppConfig.get_log_dir() / "app.log"
```

**íŠ¹ì§•:**
- `sys.frozen` ì²´í¬ë¡œ ê°œë°œ/ë¹Œë“œ ëª¨ë“œ ìë™ êµ¬ë¶„
- ê°œë°œ ì¤‘: í”„ë¡œì íŠ¸ í´ë”ì— ì €ì¥ â†’ ë””ë²„ê¹… í¸í•¨
- ë¹Œë“œ í›„: AppData ì‚¬ìš© â†’ Windows í‘œì¤€, ê¶Œí•œ ë¬¸ì œ ì—†ìŒ
- ê²½ë¡œ ë³€ê²½ ì‹œ í•œ ê³³ë§Œ ìˆ˜ì •í•˜ë©´ ì „ì²´ ë°˜ì˜

**ì‚¬ìš© ì˜ˆì‹œ:**
```python
from backend.config import AppConfig

# DB ê²½ë¡œ ìë™ ì„¤ì •
db_manager = DatabaseManager(db_path=AppConfig.get_db_path())

# í˜„ì¬ ëª¨ë“œ í™•ì¸
if AppConfig.is_dev_mode():
    print("ê°œë°œ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘")
```

---

### 1ï¸âƒ£ `backend/monitor_engine.py` - ëª¨ë‹ˆí„°ë§ ì—”ì§„
```python
class MonitorEngine(QThread):
    """
    ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œë¡œ ì‹¤í–‰
    - í™œì„± ì°½ ê°ì§€
    - í™”ë©´ ì ê¸ˆ/idle ê°ì§€
    - Chrome URL ìˆ˜ì‹ 
    - ë£° ì—”ì§„ìœ¼ë¡œ ë¶„ë¥˜ â†’ DB ì €ì¥
    """

    activity_detected = pyqtSignal(dict)  # UI ì—…ë°ì´íŠ¸ìš© ì‹œê·¸ë„

    def __init__(self, db_manager, rule_engine):
        self.window_tracker = WindowTracker()
        self.screen_detector = ScreenDetector()
        self.chrome_receiver = ChromeURLReceiver(port=8766)
        self.db_manager = db_manager
        self.rule_engine = rule_engine

        self.current_activity = None
        self.last_check_time = None

    def run(self):
        """2ì´ˆë§ˆë‹¤ í˜„ì¬ í™œë™ ì²´í¬"""
        while self.running:
            activity_info = self.collect_activity_info()

            # í™œë™ì´ ë³€ê²½ë˜ì—ˆìœ¼ë©´ ì´ì „ í™œë™ ì¢…ë£Œ + ìƒˆ í™œë™ ì‹œì‘
            if self.is_activity_changed(activity_info):
                self.end_current_activity()
                self.start_new_activity(activity_info)

            time.sleep(2)

    def collect_activity_info(self):
        """
        í˜„ì¬ í™œë™ ì •ë³´ ìˆ˜ì§‘
        ì¤‘ìš”: í™”ë©´ ì ê¸ˆ/idle ìƒíƒœë¥¼ ë¨¼ì € íŒë‹¨í•˜ì—¬ process_nameìœ¼ë¡œ ì„¤ì •
        """
        # 1. ìµœìš°ì„ : í™”ë©´ ì ê¸ˆ ìƒíƒœ
        if self.screen_detector.is_locked():
            return {
                'process_name': '__LOCKED__',
                'window_title': 'Screen Locked',
                'chrome_url': None,
                'chrome_profile': None,
            }

        # 2. ìœ íœ´(idle) ìƒíƒœ ì²´í¬ (5ë¶„ ì„ê³„ê°’)
        idle_seconds = self.screen_detector.get_idle_duration()
        if idle_seconds > 300:
            return {
                'process_name': '__IDLE__',
                'window_title': f'Idle ({idle_seconds}s)',
                'chrome_url': None,
                'chrome_profile': None,
            }

        # 3. ì¼ë°˜ í™œë™
        window_info = self.window_tracker.get_active_window()
        chrome_data = self.chrome_receiver.get_latest_url()  # {'url': ..., 'profile': ...}

        return {
            'process_name': window_info['process_name'],
            'window_title': window_info['window_title'],
            'chrome_url': chrome_data.get('url'),
            'chrome_profile': chrome_data.get('profile'),
        }

    def start_new_activity(self, info):
        """ìƒˆ í™œë™ ì‹œì‘ â†’ DB ì €ì¥"""
        tag_id, rule_id = self.rule_engine.match(info)

        self.current_activity = self.db_manager.create_activity(
            process_name=info['process_name'],
            window_title=info['window_title'],
            chrome_url=info['chrome_url'],
            chrome_profile=info['chrome_profile'],
            tag_id=tag_id,
            rule_id=rule_id
        )

        self.activity_detected.emit(info)  # UI ì—…ë°ì´íŠ¸
```

---

### 2ï¸âƒ£ `backend/rule_engine.py` - ë£° ë§¤ì¹­ ì—”ì§„
```python
class RuleEngine:
    """
    í™œë™ ì •ë³´ â†’ íƒœê·¸ ìë™ ë¶„ë¥˜
    """

    def __init__(self, db_manager):
        self.db_manager = db_manager
        self.rules_cache = []
        self.reload_rules()

    def reload_rules(self):
        """DBì—ì„œ ë£° ë¶ˆëŸ¬ì˜¤ê¸° (ìš°ì„ ìˆœìœ„ ì •ë ¬)"""
        self.rules_cache = self.db_manager.get_all_rules(
            enabled_only=True,
            order_by='priority DESC'
        )

    def match(self, activity_info):
        """
        í™œë™ ì •ë³´ì™€ ë£°ì„ ë§¤ì¹­í•´ì„œ tag_id, rule_id ë°˜í™˜

        ë‹¨ìˆœí™”ëœ ë¡œì§:
        - ëª¨ë“  ìƒíƒœ(__LOCKED__, __IDLE__ í¬í•¨)ë¥¼ í†µì¼ëœ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬
        - priority ë†’ì€ ë£°ë¶€í„° ìˆœíšŒí•˜ë©° ì²« ë§¤ì¹­ ë°˜í™˜
        """

        # ë£° ìˆœíšŒ (ìš°ì„ ìˆœìœ„ ë†’ì€ ê²ƒë¶€í„°)
        for rule in self.rules_cache:
            if self.is_matched(rule, activity_info):
                return rule['tag_id'], rule['id']

        # ë§¤ì¹­ ì‹¤íŒ¨ â†’ "ë¯¸ë¶„ë¥˜" íƒœê·¸
        unclassified_tag_id = self.db_manager.get_tag_by_name('ë¯¸ë¶„ë¥˜')['id']
        return unclassified_tag_id, None

    def is_matched(self, rule, activity_info):
        """ë£° ì¡°ê±´ê³¼ í™œë™ ì •ë³´ ë§¤ì¹­ (OR ê´€ê³„)"""

        # URL íŒ¨í„´ ë§¤ì¹­
        if rule['url_pattern']:
            if fnmatch(activity_info['chrome_url'], rule['url_pattern']):
                return True

        # Chrome í”„ë¡œí•„ ë§¤ì¹­
        if rule['chrome_profile']:
            if activity_info['chrome_profile'] == rule['chrome_profile']:
                return True

        # í”„ë¡œì„¸ìŠ¤ ì´ë¦„ ë§¤ì¹­
        if rule['process_pattern']:
            if fnmatch(activity_info['process_name'], rule['process_pattern']):
                return True

        # ì°½ ì œëª© ë§¤ì¹­
        if rule['window_title_pattern']:
            if fnmatch(activity_info['window_title'], rule['window_title_pattern']):
                return True

        return False
```

---

### 2.5ï¸âƒ£ `backend/chrome_receiver.py` - Chrome WebSocket ìˆ˜ì‹ ê¸°
```python
import threading
import asyncio
import websockets
import json

class ChromeURLReceiver:
    """
    Chrome Extensionìœ¼ë¡œë¶€í„° URL ìˆ˜ì‹  (WebSocket ì„œë²„)

    ì¤‘ìš”: ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ asyncio ì´ë²¤íŠ¸ ë£¨í”„ ì‹¤í–‰
    """

    def __init__(self, port=8766):
        self.latest_data = {}
        self.port = port
        self.lock = threading.Lock()  # ìŠ¤ë ˆë“œ ì•ˆì „ì„± í™•ë³´

        # WebSocket ì„œë²„ë¥¼ ìœ„í•œ ë³„ë„ ë°ëª¬ ìŠ¤ë ˆë“œ ì‹œì‘
        threading.Thread(target=self._start_server, daemon=True).start()

    def _start_server(self):
        """ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ asyncio ì´ë²¤íŠ¸ ë£¨í”„ ì‹¤í–‰"""
        asyncio.set_event_loop(asyncio.new_event_loop())
        loop = asyncio.get_event_loop()
        start_server = websockets.serve(self._handler, "localhost", self.port)
        loop.run_until_complete(start_server)
        print(f"[ChromeURLReceiver] WebSocket ì„œë²„ ì‹œì‘: ws://localhost:{self.port}")
        loop.run_forever()

    async def _handler(self, websocket, path):
        """Chrome Extension ì—°ê²° ì²˜ë¦¬"""
        print(f"[ChromeURLReceiver] Chrome Extension ì—°ê²°ë¨")
        async for message in websocket:
            try:
                data = json.loads(message)
                if data.get('type') == 'url_change':
                    # ìŠ¤ë ˆë“œ ì•ˆì „í•˜ê²Œ ìµœì‹  ë°ì´í„° ì €ì¥
                    with self.lock:
                        self.latest_data = {
                            'url': data.get('url'),
                            'profile': data.get('profileName'),
                            'title': data.get('title'),
                            'timestamp': data.get('timestamp'),
                        }
            except json.JSONDecodeError:
                pass

    def get_latest_url(self):
        """
        MonitorEngineì—ì„œ í˜¸ì¶œí•  ìŠ¤ë ˆë“œ ì•ˆì „í•œ í•¨ìˆ˜
        Returns: {'url': ..., 'profile': ...} or {}
        """
        with self.lock:
            return self.latest_data.copy()
```

**íŠ¹ì§•:**
- `threading.Thread`ë¡œ ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ WebSocket ì„œë²„ ì‹¤í–‰
- `MonitorEngine` (QThread)ê³¼ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘
- `threading.Lock`ìœ¼ë¡œ ìŠ¤ë ˆë“œ ì•ˆì „ì„± í™•ë³´
- Chrome Extensionì´ ì—°ê²° ëŠì–´ì ¸ë„ í”„ë¡œê·¸ë¨ì€ ì •ìƒ ë™ì‘

---

### 3ï¸âƒ£ `backend/database.py` - DB ë§¤ë‹ˆì €
```python
from backend.config import AppConfig
import sqlite3

class DatabaseManager:
    """SQLite ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬"""

    def __init__(self, db_path=None):
        # db_path ì§€ì • ì•ˆ í•˜ë©´ AppConfigì—ì„œ ìë™ ì„¤ì •
        if db_path is None:
            db_path = AppConfig.get_db_path()

        self.conn = sqlite3.connect(str(db_path), check_same_thread=False)
        self.conn.row_factory = sqlite3.Row
        self.init_database()

    def init_database(self):
        """í…Œì´ë¸” ìƒì„± + ê¸°ë³¸ ë°ì´í„° ì‚½ì…"""
        # ìœ„ì˜ SQL ìŠ¤í‚¤ë§ˆ ì‹¤í–‰

    # === íƒœê·¸ ê´€ë¦¬ ===
    def get_all_tags(self):
        """ëª¨ë“  íƒœê·¸ ì¡°íšŒ"""

    def create_tag(self, name, color):
        """íƒœê·¸ ìƒì„±"""

    def update_tag(self, tag_id, name=None, color=None):
        """íƒœê·¸ ìˆ˜ì • (ì´ë¦„ ë³€ê²½í•´ë„ activitiesëŠ” ì˜í–¥ ì—†ìŒ)"""

    def delete_tag(self, tag_id):
        """íƒœê·¸ ì‚­ì œ (activities.tag_idëŠ” NULLë¡œ)"""

    # === í™œë™ ê¸°ë¡ ===
    def create_activity(self, **kwargs):
        """ìƒˆ í™œë™ ì‹œì‘ (start_time=now, end_time=NULL)"""

    def end_activity(self, activity_id):
        """í™œë™ ì¢…ë£Œ (end_time=now)"""

    def get_activities(self, start_date, end_date):
        """ê¸°ê°„ë³„ í™œë™ ì¡°íšŒ"""

    # === í†µê³„ ===
    def get_stats_by_tag(self, start_date, end_date):
        """íƒœê·¸ë³„ ì‚¬ìš© ì‹œê°„ í†µê³„"""
        sql = """
        SELECT
            t.name AS tag_name,
            t.color AS tag_color,
            SUM((julianday(COALESCE(end_time, datetime('now'))) -
                 julianday(start_time)) * 86400) AS total_seconds
        FROM activities a
        JOIN tags t ON a.tag_id = t.id
        WHERE start_time >= ? AND start_time < ?
        GROUP BY t.id
        ORDER BY total_seconds DESC
        """

    def get_stats_by_process(self, start_date, end_date):
        """í”„ë¡œì„¸ìŠ¤ë³„ ì‚¬ìš© ì‹œê°„ í†µê³„"""

    def get_timeline(self, date, limit=100):
        """íŠ¹ì • ë‚ ì§œì˜ íƒ€ì„ë¼ì¸"""

    # === ë£° ê´€ë¦¬ ===
    def get_all_rules(self, enabled_only=False, order_by='priority DESC'):
        """ëª¨ë“  ë£° ì¡°íšŒ"""

    def create_rule(self, **kwargs):
        """ë£° ìƒì„±"""

    def update_rule(self, rule_id, **kwargs):
        """ë£° ìˆ˜ì •"""

    def delete_rule(self, rule_id):
        """ë£° ì‚­ì œ"""
```

---

## ğŸ–¥ï¸ í”„ë¡ íŠ¸ì—”ë“œ (PyQt6) êµ¬ì¡°

### 1ï¸âƒ£ `ui/main_window.py` - ë©”ì¸ ìœˆë„ìš°
```python
class MainWindow(QMainWindow):
    """
    ë©”ì¸ ìœˆë„ìš°
    - íƒ­ êµ¬ì¡° (Dashboard, Timeline, Settings)
    - ì‹œìŠ¤í…œ íŠ¸ë ˆì´ í†µí•©
    - ë°±ê·¸ë¼ìš´ë“œ ëª¨ë‹ˆí„°ë§ ì‹œì‘
    """

    def __init__(self):
        self.db_manager = DatabaseManager()
        self.rule_engine = RuleEngine(self.db_manager)
        self.monitor_engine = MonitorEngine(self.db_manager, self.rule_engine)

        # UI êµ¬ì„±
        self.create_tabs()
        self.create_tray_icon()

        # ëª¨ë‹ˆí„°ë§ ì‹œì‘
        self.monitor_engine.activity_detected.connect(self.on_activity_update)
        self.monitor_engine.start()

    def create_tabs(self):
        tabs = QTabWidget()
        tabs.addTab(DashboardTab(self.db_manager), "ğŸ“Š ëŒ€ì‹œë³´ë“œ")
        tabs.addTab(TimelineTab(self.db_manager), "â±ï¸ íƒ€ì„ë¼ì¸")
        tabs.addTab(SettingsTab(self.db_manager, self.rule_engine), "âš™ï¸ ì„¤ì •")
        self.setCentralWidget(tabs)

    def create_tray_icon(self):
        """ì‹œìŠ¤í…œ íŠ¸ë ˆì´ ì•„ì´ì½˜"""
        self.tray = QSystemTrayIcon(self)
        self.tray.setIcon(QIcon("icon.png"))

        menu = QMenu()
        menu.addAction("ì—´ê¸°", self.show)
        menu.addAction("ì¢…ë£Œ", self.quit_app)
        self.tray.setContextMenu(menu)
        self.tray.show()

    def closeEvent(self, event):
        """ì°½ ë‹«ê¸° â†’ íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”"""
        event.ignore()
        self.hide()
```

---

### 2ï¸âƒ£ `ui/dashboard_tab.py` - ëŒ€ì‹œë³´ë“œ íƒ­
```python
class DashboardTab(QWidget):
    """
    ì˜¤ëŠ˜ì˜ í†µê³„ ëŒ€ì‹œë³´ë“œ
    - íƒœê·¸ë³„ ì‚¬ìš© ì‹œê°„ (ì¹´ë“œ + ì§„í–‰ë¥  ë°”)
    - íŒŒì´ ì°¨íŠ¸ (matplotlib)
    - í”„ë¡œì„¸ìŠ¤ë³„ TOP 5
    """

    def __init__(self, db_manager):
        self.db_manager = db_manager

        layout = QVBoxLayout()

        # ë‚ ì§œ ì„ íƒ
        layout.addWidget(self.create_date_selector())

        # í†µê³„ ì¹´ë“œ
        layout.addLayout(self.create_stat_cards())

        # ì°¨íŠ¸ ì˜ì—­
        layout.addWidget(self.create_chart_area())

        self.setLayout(layout)

        # 10ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ 
        self.timer = QTimer()
        self.timer.timeout.connect(self.refresh_stats)
        self.timer.start(10000)

    def refresh_stats(self):
        """í†µê³„ ë°ì´í„° ê°±ì‹ """
        today = datetime.now().date()
        stats = self.db_manager.get_stats_by_tag(today, today + timedelta(days=1))
        self.update_cards(stats)
        self.update_chart(stats)
```

---

### 3ï¸âƒ£ `ui/timeline_tab.py` - íƒ€ì„ë¼ì¸ íƒ­
```python
class TimelineTab(QWidget):
    """
    í™œë™ íƒ€ì„ë¼ì¸ (í…Œì´ë¸”)
    - ì‹œê°„, í”„ë¡œì„¸ìŠ¤, ì œëª©/URL, íƒœê·¸, ì‹œê°„ í‘œì‹œ
    - í•„í„°ë§ (ë‚ ì§œ, íƒœê·¸)
    - ìˆ˜ë™ íƒœê·¸ ë³€ê²½ ê°€ëŠ¥
    """

    def __init__(self, db_manager):
        self.db_manager = db_manager

        layout = QVBoxLayout()

        # í•„í„°
        layout.addLayout(self.create_filters())

        # í…Œì´ë¸”
        self.table = QTableWidget()
        self.table.setColumnCount(6)
        self.table.setHorizontalHeaderLabels([
            "ì‹œì‘ ì‹œê°„", "ì¢…ë£Œ ì‹œê°„", "í”„ë¡œì„¸ìŠ¤", "ì œëª©/URL", "íƒœê·¸", "ì‹œê°„"
        ])
        layout.addWidget(self.table)

        self.setLayout(layout)
        self.load_timeline()

    def load_timeline(self):
        """íƒ€ì„ë¼ì¸ ë°ì´í„° ë¡œë“œ"""
        activities = self.db_manager.get_timeline(self.selected_date)
        self.populate_table(activities)
```

---

### 4ï¸âƒ£ `ui/settings_tab.py` - ì„¤ì • íƒ­
```python
class SettingsTab(QWidget):
    """
    ì„¤ì • íƒ­
    - íƒœê·¸ ê´€ë¦¬ (ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ)
    - ë£° ê´€ë¦¬ (ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ/ìš°ì„ ìˆœìœ„)
    """

    def __init__(self, db_manager, rule_engine):
        self.db_manager = db_manager
        self.rule_engine = rule_engine

        layout = QHBoxLayout()

        # ì™¼ìª½: íƒœê·¸ ê´€ë¦¬
        layout.addWidget(self.create_tag_manager())

        # ì˜¤ë¥¸ìª½: ë£° ê´€ë¦¬
        layout.addWidget(self.create_rule_manager())

        self.setLayout(layout)

    def create_tag_manager(self):
        """íƒœê·¸ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ UI"""
        widget = QGroupBox("íƒœê·¸ ê´€ë¦¬")
        layout = QVBoxLayout()

        # íƒœê·¸ ë¦¬ìŠ¤íŠ¸
        self.tag_list = QListWidget()
        self.load_tags()

        # ë²„íŠ¼
        btn_layout = QHBoxLayout()
        btn_layout.addWidget(QPushButton("ì¶”ê°€", clicked=self.add_tag))
        btn_layout.addWidget(QPushButton("ìˆ˜ì •", clicked=self.edit_tag))
        btn_layout.addWidget(QPushButton("ì‚­ì œ", clicked=self.delete_tag))

        layout.addWidget(self.tag_list)
        layout.addLayout(btn_layout)
        widget.setLayout(layout)
        return widget

    def create_rule_manager(self):
        """ë£° ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ UI"""
        widget = QGroupBox("ë¶„ë¥˜ ë£° ê´€ë¦¬")
        layout = QVBoxLayout()

        # ë£° í…Œì´ë¸”
        self.rule_table = QTableWidget()
        self.rule_table.setColumnCount(5)
        self.rule_table.setHorizontalHeaderLabels([
            "ìš°ì„ ìˆœìœ„", "ì´ë¦„", "ì¡°ê±´", "íƒœê·¸", "í™œì„±í™”"
        ])
        self.load_rules()

        # ë²„íŠ¼
        btn_layout = QHBoxLayout()
        btn_layout.addWidget(QPushButton("ì¶”ê°€", clicked=self.add_rule))
        btn_layout.addWidget(QPushButton("ìˆ˜ì •", clicked=self.edit_rule))
        btn_layout.addWidget(QPushButton("ì‚­ì œ", clicked=self.delete_rule))

        layout.addWidget(self.rule_table)
        layout.addLayout(btn_layout)
        widget.setLayout(layout)
        return widget

    def add_rule(self):
        """ë£° ì¶”ê°€ ë‹¤ì´ì–¼ë¡œê·¸"""
        dialog = RuleEditDialog(self.db_manager)
        if dialog.exec():
            rule_data = dialog.get_rule_data()
            self.db_manager.create_rule(**rule_data)
            self.rule_engine.reload_rules()  # ë£° ì—”ì§„ ê°±ì‹ !
            self.load_rules()
```

---

## ğŸ”„ ì‹¤í–‰ íë¦„

### í”„ë¡œê·¸ë¨ ì‹œì‘
1. `main.py` ì‹¤í–‰
2. SQLite DB ì´ˆê¸°í™” (í…Œì´ë¸” ìƒì„±, ê¸°ë³¸ ë°ì´í„°)
3. PyQt6 ë©”ì¸ ìœˆë„ìš° ìƒì„±
4. ë°±ê·¸ë¼ìš´ë“œ ëª¨ë‹ˆí„°ë§ ìŠ¤ë ˆë“œ ì‹œì‘
5. Chrome Extension WebSocket ì„œë²„ ì‹œì‘ (í¬íŠ¸ 8766)
6. ì‹œìŠ¤í…œ íŠ¸ë ˆì´ì— ì•„ì´ì½˜ í‘œì‹œ

### í™œë™ ì¶”ì  ë£¨í”„ (2ì´ˆë§ˆë‹¤)
1. **WindowTracker** - í™œì„± ì°½ ì •ë³´ ìˆ˜ì§‘
2. **ScreenDetector** - í™”ë©´ ì ê¸ˆ/idle ì²´í¬
3. **ChromeURLReceiver** - ìµœì‹  Chrome URL ê°€ì ¸ì˜¤ê¸°
4. **í™œë™ ë³€ê²½ ê°ì§€**
   - ì´ì „ í™œë™ê³¼ ë‹¤ë¥´ë©´?
     - ì´ì „ í™œë™ ì¢…ë£Œ (end_time ì—…ë°ì´íŠ¸)
     - ìƒˆ í™œë™ ì‹œì‘ (DB INSERT)
5. **RuleEngine** - ë£° ë§¤ì¹­í•´ì„œ íƒœê·¸ ìë™ ë¶„ë¥˜
6. **UI ì—…ë°ì´íŠ¸** - ì‹œê·¸ë„ë¡œ í”„ë¡ íŠ¸ì—”ë“œì— ì•Œë¦¼

### ì‚¬ìš©ì ì¸í„°ë™ì…˜
- **ëŒ€ì‹œë³´ë“œ**: ì‹¤ì‹œê°„ í†µê³„ í™•ì¸
- **íƒ€ì„ë¼ì¸**: ê³¼ê±° í™œë™ ê²€ìƒ‰, ìˆ˜ë™ íƒœê·¸ ë³€ê²½
- **ì„¤ì •**: íƒœê·¸/ë£° ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ â†’ RuleEngine ì¦‰ì‹œ ë¦¬ë¡œë“œ

---

## ğŸ¨ UI/UX íŠ¹ì§•

### ì‹œìŠ¤í…œ íŠ¸ë ˆì´ í†µí•©
- ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (í•­ìƒ ëª¨ë‹ˆí„°ë§)
- íŠ¸ë ˆì´ ì•„ì´ì½˜ í´ë¦­ â†’ ë©”ì¸ ì°½ ì—´ê¸°
- ì°½ ë‹«ê¸° â†’ íŠ¸ë ˆì´ë¡œ ìµœì†Œí™”

### ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
- ëŒ€ì‹œë³´ë“œ: 10ì´ˆë§ˆë‹¤ í†µê³„ ê°±ì‹ 
- íƒ€ì„ë¼ì¸: ìƒˆ í™œë™ ì¶”ê°€ ì‹œ ìë™ ì¶”ê°€
- ì„¤ì •: ë£° ë³€ê²½ â†’ ì¦‰ì‹œ ì ìš©

### ë‹¤í¬ í…Œë§ˆ
- GitHub ìŠ¤íƒ€ì¼ ë‹¤í¬ ëª¨ë“œ
- QSSë¡œ í†µì¼ëœ ë””ìì¸

---

## ğŸš€ êµ¬í˜„ ìˆœì„œ

### Phase 1: ë°±ì—”ë“œ ì½”ì–´
1. âœ… ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ êµ¬í˜„
2. âœ… DatabaseManager êµ¬í˜„
3. âœ… í…ŒìŠ¤íŠ¸ íŒŒì¼ 3ê°œ í†µí•© â†’ MonitorEngine
4. âœ… RuleEngine êµ¬í˜„

### Phase 2: í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë³¸
5. âœ… MainWindow + íƒ­ êµ¬ì¡°
6. âœ… DashboardTab (ê¸°ë³¸ í†µê³„)
7. âœ… TimelineTab (í…Œì´ë¸”)

### Phase 3: ì„¤ì • ê¸°ëŠ¥
8. âœ… SettingsTab - íƒœê·¸ ê´€ë¦¬
9. âœ… SettingsTab - ë£° ê´€ë¦¬
10. âœ… RuleEditDialog (ë£° ì¶”ê°€/ìˆ˜ì • UI)

### Phase 4: ê³ ê¸‰ ê¸°ëŠ¥
11. âœ… ì°¨íŠ¸ (matplotlib í†µí•©)
12. âœ… ì‹œìŠ¤í…œ íŠ¸ë ˆì´
13. âœ… ìë™ ì‹œì‘ (Windows ì‹œì‘ í”„ë¡œê·¸ë¨ ë“±ë¡)

### Phase 5: íŒ¨í‚¤ì§•
14. âœ… PyInstallerë¡œ ì‹¤í–‰ íŒŒì¼ ìƒì„±
15. âœ… ì„¤ì¹˜ í”„ë¡œê·¸ë¨ (ì„ íƒ)

---

## ğŸ“ í•µì‹¬ ì„¤ê³„ ê²°ì •

### 1. íƒœê·¸ ID ê¸°ë°˜ ì°¸ì¡°
- íƒœê·¸ ì´ë¦„ ë³€ê²½ ì‹œ activities í…Œì´ë¸” ì˜í–¥ ì—†ìŒ
- `UPDATE tags SET name='ì—°êµ¬' WHERE id=1` â†’ ëª¨ë“  ê¸°ë¡ ìë™ ë°˜ì˜

### 2. ë£° ìš°ì„ ìˆœìœ„
- í™”ë©´ ì ê¸ˆ > URL > Chrome í”„ë¡œí•„ > í”„ë¡œì„¸ìŠ¤ > ì°½ ì œëª©
- ìš°ì„ ìˆœìœ„ ìˆ«ìë¡œ ì‚¬ìš©ì ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥

### 3. ì™€ì¼ë“œì¹´ë“œ íŒ¨í„´
- `*youtube.com*` - YouTube ê´€ë ¨ ëª¨ë“  URL
- `*github.com/user/work-repo*` - íŠ¹ì • ë ˆí¬ì§€í† ë¦¬ë§Œ

### 4. ì‹¤ì‹œê°„ ë£° ê°±ì‹ 
- ì„¤ì •ì—ì„œ ë£° ë³€ê²½ â†’ `rule_engine.reload_rules()` í˜¸ì¶œ
- ë‹¤ìŒ í™œë™ë¶€í„° ì¦‰ì‹œ ì ìš©

### 5. í™œë™ êµ¬ê°„ ì €ì¥
- `start_time` ~ `end_time` êµ¬ê°„
- í†µê³„ ê³„ì‚° ì‹œ `SUM(julianday(end_time) - julianday(start_time))`

---

## ğŸ“¦ ë¹Œë“œ ë° ë°°í¬

### .gitignore ì„¤ì •
```gitignore
# ë°ì´í„°ë² ì´ìŠ¤
activity_tracker.db
activity_tracker.db-journal
*.db
*.db-journal

# ì„¤ì • íŒŒì¼
config.json

# ë¡œê·¸
logs/
*.log

# Python
__pycache__/
*.pyc
*.pyo
*.pyd
.Python
*.so
*.egg
*.egg-info/
dist/
build/

# PyInstaller
*.spec

# IDE
.vscode/
.idea/
*.swp
*.swo
```

### PyInstaller ë¹Œë“œ
```bash
# PyInstaller ì„¤ì¹˜
pip install pyinstaller

# ì‹¤í–‰ íŒŒì¼ ìƒì„± (í„°ë¯¸ë„ ì—†ì´)
pyinstaller --windowed --onefile --name="ActivityTracker" --icon=icon.ico main.py

# ê²°ê³¼: dist/ActivityTracker.exe
```

**ë¹Œë“œ ì˜µì…˜:**
- `--windowed` (ë˜ëŠ” `-w`) - í„°ë¯¸ë„ ì°½ ìˆ¨ê¹€
- `--onefile` - ë‹¨ì¼ .exe íŒŒì¼ ìƒì„±
- `--name` - ì‹¤í–‰ íŒŒì¼ ì´ë¦„
- `--icon` - ì•„ì´ì½˜ íŒŒì¼ ì§€ì •

**ë¹Œë“œ í›„ ë™ì‘:**
- `sys.frozen = True` â†’ AppConfigê°€ ìë™ìœ¼ë¡œ AppData ê²½ë¡œ ì‚¬ìš©
- ê°œë°œ ì¤‘ DBëŠ” í”„ë¡œì íŠ¸ í´ë”, ë¹Œë“œ í›„ DBëŠ” AppDataì— ë¶„ë¦¬

### Windows ì‹œì‘ í”„ë¡œê·¸ë¨ ë“±ë¡
```python
# UI ì„¤ì • íƒ­ì—ì„œ ì²´í¬ë°•ìŠ¤ë¡œ ì œê³µ
import winreg
import sys

def add_to_startup():
    key = winreg.OpenKey(
        winreg.HKEY_CURRENT_USER,
        r"Software\Microsoft\Windows\CurrentVersion\Run",
        0, winreg.KEY_SET_VALUE
    )
    winreg.SetValueEx(key, "ActivityTracker", 0, winreg.REG_SZ, sys.executable)
    winreg.CloseKey(key)
```

---

## ğŸ” ë³´ì•ˆ/í”„ë¼ì´ë²„ì‹œ
- ëª¨ë“  ë°ì´í„° ë¡œì»¬ ì €ì¥ (SQLite)
- ë„¤íŠ¸ì›Œí¬ í†µì‹ ì€ localhost WebSocketë§Œ (Chrome Extension)
- ë°°í¬ ì•ˆí•¨, ê°œì¸ ì‚¬ìš©

---

## ğŸ“ AI ê²€í†  ë°˜ì˜ ì‚¬í•­

### 1. RuleEngine ë¡œì§ ë‹¨ìˆœí™” âœ…
**ë¬¸ì œ:** `is_locked`, `is_idle` ìƒíƒœë¥¼ ì½”ë“œì—ì„œ í•˜ë“œì½”ë”© + DB ë£°ë¡œ ì¤‘ë³µ ì²˜ë¦¬

**í•´ê²°:**
- `MonitorEngine.collect_activity_info()`ì—ì„œ ìƒíƒœë¥¼ ë¨¼ì € íŒë‹¨
- í™”ë©´ ì ê¸ˆ â†’ `process_name = '__LOCKED__'`
- Idle ìƒíƒœ â†’ `process_name = '__IDLE__'`
- `RuleEngine.match()`ëŠ” ëª¨ë“  ìƒíƒœë¥¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ (priority ê¸°ë°˜)

**ì¥ì :**
- í•˜ë“œì½”ë”© ì œê±°, ëª¨ë“  ë¡œì§ì´ `rules` í…Œì´ë¸”ë¡œ ìœ„ì„
- ì‚¬ìš©ìê°€ UIì—ì„œ ììœ ë¡­ê²Œ idle ì„ê³„ê°’ ë³€ê²½ ê°€ëŠ¥ (ë£° ìš°ì„ ìˆœìœ„ ì¡°ì •)

### 2. activities í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë‹¨ìˆœí™” âœ…
**ë¬¸ì œ:** `is_locked`, `is_idle` ì»¬ëŸ¼ì´ `tag_id`ì™€ ì¤‘ë³µ

**í•´ê²°:**
- `is_locked`, `is_idle`, `idle_seconds` ì»¬ëŸ¼ ì œê±°
- ìƒíƒœëŠ” `process_name`ê³¼ `tag_id`ë¡œ ì¶©ë¶„íˆ íŒë³„ ê°€ëŠ¥
- í•„ìš” ì‹œ 'í™”ë©´ì ê¸ˆ', 'ìœ íœ´ìƒíƒœ' íƒœê·¸ë¥¼ ë³„ë„ë¡œ ìƒì„±

**ì¥ì :**
- ë°ì´í„° ì¤‘ë³µ ì œê±°
- ìŠ¤í‚¤ë§ˆ ë‹¨ìˆœí™”

### 3. WebSocket ì„œë²„ ìŠ¤ë ˆë“œ ê´€ë¦¬ âœ…
**ë¬¸ì œ:** `ChromeURLReceiver`ì˜ asyncio ì´ë²¤íŠ¸ ë£¨í”„ê°€ ë©”ì¸/QThread ì°¨ë‹¨ ê°€ëŠ¥ì„±

**í•´ê²°:**
- `threading.Thread(daemon=True)`ë¡œ ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ WebSocket ì„œë²„ ì‹¤í–‰
- `threading.Lock`ìœ¼ë¡œ ìŠ¤ë ˆë“œ ì•ˆì „ì„± í™•ë³´
- `MonitorEngine` (QThread)ê³¼ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘

**ì¥ì :**
- UI/ëª¨ë‹ˆí„°ë§ ìŠ¤ë ˆë“œ ì°¨ë‹¨ ë°©ì§€
- Chrome Extension ì—°ê²° ëŠì–´ì ¸ë„ í”„ë¡œê·¸ë¨ ì •ìƒ ë™ì‘

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„
Phase 1ë¶€í„° êµ¬í˜„ ì‹œì‘!
